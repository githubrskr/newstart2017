<?xml version="1.0" encoding="UTF-8"?>
<sequence xmlns="http://ws.apache.org/ns/synapse" name="PODSAuthorizationForESBCorp">
	<!--<property name="isAuthorizationValid" value="false" scope="default" type="BOOLEAN" />-->
    <property name="PODS_ESB_CORP_USR" expression="get-property('system','uk.gov.hmrc.wso2.fast.corp.esb.username')" scope="default" type="STRING" />
    <property name="PODS_ESB_CORP_PWD" expression="get-property('system','uk.gov.hmrc.wso2.fast.corp.esb.password')" scope="default" type="STRING" />
	<filter source="$ctx:PODS_ESB_CORP_USR='' or $ctx:PODS_ESB_CORP_PWD=''" regex="false">
		<then>
			<!--<property name="isAuthorizationValid" value="true" scope="default" type="BOOLEAN" />-->
			<property name="PODS_ESB_CORP_AUTH_CREDENTIALS" expression="fn:concat($ctx:PODS_ESB_CORP_USR,':',$ctx:PODS_ESB_CORP_PWD)" scope="default" type="STRING" />
			<header name="Authorization" scope="transport" action="remove" />
			<header name="Authorization" scope="transport" expression="fn:concat('Basic ', base64Encode($ctx:PODS_ESB_CORP_AUTH_CREDENTIALS))" />
			<property name="responseType" expression="$trp:Accept" scope="default" type="STRING" />
		</then>
	</filter>
</sequence>